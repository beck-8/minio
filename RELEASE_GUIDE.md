# MinIO Release Guide

This guide explains how to use the GoReleaser configuration to build and release MinIO binaries and Docker images.

## Prerequisites

### GitHub Secrets

You need to configure the following secrets in your GitHub repository:

1. **DOCKERHUB_USERNAME**: Your Docker Hub username (e.g., `beck8`)
2. **DOCKERHUB_TOKEN**: Your Docker Hub access token
3. **GITHUB_TOKEN**: Automatically provided by GitHub Actions (no need to configure)

To add secrets:
1. Go to your repository on GitHub
2. Navigate to `Settings` → `Secrets and variables` → `Actions`
3. Click `New repository secret`
4. Add `DOCKERHUB_USERNAME` and `DOCKERHUB_TOKEN`

### Docker Hub Setup

Make sure you have created the repository on Docker Hub:
- Repository: `beck8/minio`

### GitHub Container Registry Setup

GitHub Container Registry (GHCR) is automatically available for your repository.
Images will be pushed to: `ghcr.io/beck-8/minio`

## Release Process

### Automatic Release (Recommended)

1. **Create a release tag** following the MinIO naming convention:
   ```bash
   # Format: RELEASE.YYYY-MM-DDTHH-MM-SSZ
   # Example:
   git tag RELEASE.2025-10-22T12-34-56Z
   git push origin RELEASE.2025-10-22T12-34-56Z
   ```

2. **For CVE or Security releases**:
   ```bash
   git tag "RELEASE.2025-10-22T12-34-56Z Security/CVE"
   git push origin "RELEASE.2025-10-22T12-34-56Z Security/CVE"
   ```

3. **GitHub Actions will automatically**:
   - Build binaries for all supported platforms
   - Create checksums
   - Build Docker images for amd64, arm64, ppc64le
   - Push images to Docker Hub and GHCR
   - Create a GitHub release with all artifacts

### Manual Release

You can also trigger a release manually:

1. Go to your repository on GitHub
2. Navigate to `Actions` → `Release`
3. Click `Run workflow`
4. Enter the tag name (e.g., `RELEASE.2025-10-22T12-34-56Z`)
5. Click `Run workflow`

## Supported Platforms

### Binaries

The release will generate binaries for the following platforms:

| OS | Architectures |
|----|---------------|
| Linux | amd64, arm64, ppc64le, s390x, arm, 386, mips, mips64, riscv64 |
| macOS | amd64, arm64 |
| Windows | amd64 |
| FreeBSD | amd64 |
| NetBSD | amd64 |
| OpenBSD | amd64 |

### Docker Images

Multi-architecture Docker images supporting:
- `linux/amd64`
- `linux/arm64`
- `linux/ppc64le`

## Release Artifacts

After a successful release, you'll find:

### GitHub Release Page
- Binary archives (`.tar.gz` for Linux/macOS, `.zip` for Windows)
- Checksums file (`minio_RELEASE.xxxx_checksums.txt`)
- Source code archives (auto-generated by GitHub)

### Docker Registries

**Docker Hub:**
```bash
docker pull beck8/minio:latest
docker pull beck8/minio:RELEASE.2025-10-22T12-34-56Z
```

**GitHub Container Registry:**
```bash
docker pull ghcr.io/beck-8/minio:latest
docker pull ghcr.io/beck-8/minio:RELEASE.2025-10-22T12-34-56Z
```

## Archive Naming Convention

Binary archives follow this pattern:
- `minio_Linux_x86_64.tar.gz`
- `minio_Linux_aarch64.tar.gz`
- `minio_Darwin_x86_64.tar.gz`
- `minio_Darwin_aarch64.tar.gz`
- `minio_Windows_x86_64.zip`
- etc.

## Local Testing

### Test GoReleaser Configuration

To test the GoReleaser configuration locally without publishing:

```bash
# Install GoReleaser (if not already installed)
# On macOS:
brew install goreleaser

# On Linux:
# Download from https://github.com/goreleaser/goreleaser/releases

# Run in snapshot mode (no publishing)
goreleaser release --snapshot --clean
```

This will:
- Build all binaries
- Create archives
- Build Docker images locally
- But NOT push anything to registries or create GitHub releases

### Test Docker Image Locally

```bash
# Build a local image
docker buildx build --platform linux/amd64 -t test-minio:local -f Dockerfile.goreleaser .

# Run the image
docker run -p 9000:9000 test-minio:local server /data
```

## Troubleshooting

### Docker Login Issues

If you encounter Docker Hub authentication issues:
```bash
# Verify your token has push permissions
# Re-generate a new token from Docker Hub:
# 1. Go to https://hub.docker.com/settings/security
# 2. Generate a new access token with Read, Write, Delete permissions
# 3. Update DOCKERHUB_TOKEN in GitHub Secrets
```

### Build Timeout

For the ppc64le architecture, QEMU emulation can be slow. If builds timeout:
- The workflow has a default timeout of 60 minutes
- Consider splitting the release into multiple jobs if needed

### GoReleaser Version

This configuration uses GoReleaser v2. If you need to pin a specific version:

```yaml
# In .github/workflows/release.yml
- name: Run GoReleaser
  uses: goreleaser/goreleaser-action@v6
  with:
    version: 'v2.3.2'  # Specify exact version
```

## Versioning Strategy

MinIO uses timestamp-based versioning:
- Format: `RELEASE.YYYY-MM-DDTHH-MM-SSZ`
- Example: `RELEASE.2025-10-22T12-34-56Z`
- For CVE releases: `RELEASE.2025-10-22T12-34-56Z Security/CVE`

This differs from semantic versioning (v1.0.0, v2.0.0) but maintains compatibility with the original MinIO versioning scheme.

## Maintenance

### Updating Supported Platforms

To add or remove platforms, edit `.goreleaser.yml`:

```yaml
builds:
  - goos:
      - linux
      - darwin
      # Add new OS here
    goarch:
      - amd64
      - arm64
      # Add new architecture here
```

### Updating Docker Base Image

The Docker images use `registry.access.redhat.com/ubi9/ubi-micro:latest` as the base.

To change the base image, edit `Dockerfile.goreleaser`:
```dockerfile
FROM your-base-image:tag
```

## References

- [GoReleaser Documentation](https://goreleaser.com)
- [Docker Buildx Documentation](https://docs.docker.com/buildx/working-with-buildx/)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Original MinIO Repository](https://github.com/minio/minio)
